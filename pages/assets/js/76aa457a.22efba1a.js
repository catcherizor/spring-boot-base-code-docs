"use strict";(self.webpackChunkspring_boot_base_code_docs=self.webpackChunkspring_boot_base_code_docs||[]).push([[4707],{3451:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>d});var r=i(4848),s=i(8453);const t={sidebar_position:2,authors:[{name:"Yaman",title:"Docker Configuration"}]},o="Docker Configuration",a={id:"guides/docker-configuration",title:"Docker Configuration",description:"In the project, there are two Dockerfiles: one for the local environment and another for the staging environment, named Dockerfile.staging. This separation ensures easier and isolated deployment configurations.For the local environment Dockerfile, you don't need to pass build arguments during the build process, as it will use the default application properties. However, for the staging Dockerfile, you need to pass build arguments to set the environment variables appropriately.",source:"@site/docs/guides/docker-configuration.md",sourceDirName:"guides",slug:"/guides/docker-configuration",permalink:"/spring-boot-base-code-docs/pages/docs/guides/docker-configuration",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/guides/docker-configuration.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,authors:[{name:"Yaman",title:"Docker Configuration"}]},sidebar:"tutorialSidebar",previous:{title:"Examples",permalink:"/spring-boot-base-code-docs/pages/docs/guides/development-tutorial/examples"},next:{title:"Code Base",permalink:"/spring-boot-base-code-docs/pages/docs/category/code-base"}},c={},d=[{value:"Dockerfile",id:"dockerfile",level:2},{value:"Dockerfile.staging",id:"dockerfile.staging",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"docker-configuration",children:"Docker Configuration"}),"\n",(0,r.jsx)(n.h1,{id:"basic",children:"Basic"}),"\n",(0,r.jsx)(n.p,{children:"In the project, there are two Dockerfiles: one for the local environment and another for the staging environment, named Dockerfile.staging. This separation ensures easier and isolated deployment configurations.For the local environment Dockerfile, you don't need to pass build arguments during the build process, as it will use the default application properties. However, for the staging Dockerfile, you need to pass build arguments to set the environment variables appropriately."}),"\n",(0,r.jsx)(n.h2,{id:"dockerfile",children:"Dockerfile"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'# build\r\nFROM maven:3.9.4-eclipse-temurin-17 AS build\r\n\r\nCOPY . /usr/src/app\r\n\r\nWORKDIR /usr/src/app\r\nRUN mvn package -DskipTests\r\n\r\n# run\r\nFROM eclipse-temurin:17-jre\r\nWORKDIR /usr/src/app\r\nCOPY --from=build /usr/src/app/target/backend-0.0.1-SNAPSHOT.jar /usr/src/app/app.jar\r\nEXPOSE 8081\r\nENTRYPOINT ["java", "-Dspring.profiles.active=localdocker", "-jar", "app.jar"]\r\n\n'})}),"\n",(0,r.jsx)(n.p,{children:"This Dockerfile defines a multi-stage build process for a Java application using Maven and Eclipse Temurin JDK. Here\u2019s the detailed flow:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Build Stage"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Base Image"}),": The first stage uses the Maven image ",(0,r.jsx)(n.code,{children:"maven:3.9.4-eclipse-temurin-17"})," which comes with Maven 3.9.4 and Eclipse Temurin JDK 17 pre-installed."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Copy Source Code"}),": The entire source code is copied from the local machine to the container at ",(0,r.jsx)(n.code,{children:"/usr/src/app"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Set Working Directory"}),": The working directory within the container is set to ",(0,r.jsx)(n.code,{children:"/usr/src/app"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Build Application"}),": Maven is used to package the application. The ",(0,r.jsx)(n.code,{children:"-DskipTests"})," option skips running tests to speed up the build process."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Run Stage"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Base Image"}),": The second stage uses the ",(0,r.jsx)(n.code,{children:"eclipse-temurin:17-jre"})," image, which provides a runtime environment with the JRE (Java Runtime Environment) only, making it lighter than a full JDK."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Set Working Directory"}),": The working directory within the container is set to ",(0,r.jsx)(n.code,{children:"/usr/src/app"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Copy Built Artifact"}),": The JAR file created in the build stage is copied from the build stage to the run stage container at ",(0,r.jsx)(n.code,{children:"/usr/src/app/app.jar"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Expose Port"}),": Port 8081 is exposed to allow access to the application."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Set Entry Point"}),": The container is configured to run the application using the ",(0,r.jsx)(n.code,{children:"java"})," command. The ",(0,r.jsx)(n.code,{children:"-Dspring.profiles.active=localdocker"})," argument specifies that the ",(0,r.jsx)(n.code,{children:"localdocker"})," profile should be used for Spring Boot, and the ",(0,r.jsx)(n.code,{children:"-jar"})," option specifies the JAR file to run."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"In summary, the Dockerfile builds the Java application using Maven in the first stage and creates a lightweight runtime container in the second stage to run the built application. This approach optimizes the final image size by excluding unnecessary build dependencies."}),"\n",(0,r.jsx)(n.h2,{id:"dockerfile.staging",children:"Dockerfile.staging"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'# build\r\nFROM maven:3.9.4-eclipse-temurin-17 AS build\r\n# Define build arguments\r\nARG DB_USERNAME\r\nARG DB_PASSWORD\r\nARG DB_URL_SYSTEM\r\n\r\nENV DB_URL_SYSTEM=${DB_URL_SYSTEM}\r\nENV DB_USERNAME=${DB_USERNAME}\r\nENV DB_PASSWORD=${DB_PASSWORD}\r\nCOPY . /usr/src/app\r\n\r\nWORKDIR /usr/src/app\r\nRUN mkdir -p /usr/src/basecode_end_user_backend_volume\r\nRUN mkdir -p /usr/src/basecode_end_user_backend_logs\r\nRUN mvn package -DskipTests\r\n\r\n# run\r\nFROM eclipse-temurin:17-jre\r\nARG DB_USERNAME\r\nARG DB_PASSWORD\r\nARG DB_URL_SYSTEM\r\n\r\nENV DB_URL_SYSTEM=${DB_URL_SYSTEM}\r\nENV DB_USERNAME=${DB_USERNAME}\r\nENV DB_PASSWORD=${DB_PASSWORD}\r\nWORKDIR /usr/src/app\r\nCOPY --from=build /usr/src/app/target/backend-0.0.1-SNAPSHOT.jar /usr/src/app/app.jar\r\nEXPOSE 9093\r\nENTRYPOINT ["java", "-Dspring.profiles.active=staging", "-jar", "app.jar"]\r\n\n'})}),"\n",(0,r.jsx)(n.p,{children:"This Dockerfile also defines a multi-stage build process for a Java application, similar to the previous one, but with additional build arguments and environment variables for database configuration. Here's the detailed flow:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Build Stage"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Base Image"}),": Uses the Maven image ",(0,r.jsx)(n.code,{children:"maven:3.9.4-eclipse-temurin-17"})," which comes with Maven 3.9.4 and Eclipse Temurin JDK 17 pre-installed."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Define Build Arguments"}),": The build arguments ",(0,r.jsx)(n.code,{children:"DB_USERNAME"}),", ",(0,r.jsx)(n.code,{children:"DB_PASSWORD"}),", and ",(0,r.jsx)(n.code,{children:"DB_URL_SYSTEM"})," are defined to pass database configuration values during the build process."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Set Environment Variables"}),": The environment variables ",(0,r.jsx)(n.code,{children:"DB_URL_SYSTEM"}),", ",(0,r.jsx)(n.code,{children:"DB_USERNAME"}),", and ",(0,r.jsx)(n.code,{children:"DB_PASSWORD"})," are set using the build arguments."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Copy Source Code"}),": The entire source code is copied from the local machine to the container at ",(0,r.jsx)(n.code,{children:"/usr/src/app"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Set Working Directory"}),": The working directory within the container is set to ",(0,r.jsx)(n.code,{children:"/usr/src/app"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Create Directories"}),": Two directories, ",(0,r.jsx)(n.code,{children:"/usr/src/basecode_end_user_backend_volume"})," and ",(0,r.jsx)(n.code,{children:"/usr/src/basecode_end_user_backend_logs"}),", are created within the container. These could be used for storing application data and logs, respectively."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Build Application"}),": Maven is used to package the application. The ",(0,r.jsx)(n.code,{children:"-DskipTests"})," option skips running tests to speed up the build process."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Run Stage"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Base Image"}),": Uses the ",(0,r.jsx)(n.code,{children:"eclipse-temurin:17-jre"})," image, which provides a runtime environment with the JRE (Java Runtime Environment) only, making it lighter than a full JDK."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Define Build Arguments"}),": The build arguments ",(0,r.jsx)(n.code,{children:"DB_USERNAME"}),", ",(0,r.jsx)(n.code,{children:"DB_PASSWORD"}),", and ",(0,r.jsx)(n.code,{children:"DB_URL_SYSTEM"})," are redefined for this stage."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Set Environment Variables"}),": The environment variables ",(0,r.jsx)(n.code,{children:"DB_URL_SYSTEM"}),", ",(0,r.jsx)(n.code,{children:"DB_USERNAME"}),", and ",(0,r.jsx)(n.code,{children:"DB_PASSWORD"})," are set again using the build arguments."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Set Working Directory"}),": The working directory within the container is set to ",(0,r.jsx)(n.code,{children:"/usr/src/app"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Copy Built Artifact"}),": The JAR file created in the build stage is copied from the build stage to the run stage container at ",(0,r.jsx)(n.code,{children:"/usr/src/app/app.jar"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Expose Port"}),": Port 9093 is exposed to allow access to the application."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Set Entry Point"}),": The container is configured to run the application using the ",(0,r.jsx)(n.code,{children:"java"})," command. The ",(0,r.jsx)(n.code,{children:"-Dspring.profiles.active=staging"})," argument specifies that the ",(0,r.jsx)(n.code,{children:"staging"})," profile should be used for Spring Boot, and the ",(0,r.jsx)(n.code,{children:"-jar"})," option specifies the JAR file to run."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["In summary, this Dockerfile builds the Java application using Maven in the first stage with specific database configurations, and then creates a lightweight runtime container in the second stage to run the built application using the ",(0,r.jsx)(n.code,{children:"staging"})," profile. This approach ensures that database configurations are passed securely and the final image size is optimized by excluding unnecessary build dependencies."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>a});var r=i(6540);const s={},t=r.createContext(s);function o(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);